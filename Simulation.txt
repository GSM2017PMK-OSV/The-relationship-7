import numpy as np
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D
import tkinter as tk
from tkinter import messagebox

def show_message():
    root = tk.Tk()
    root.withdraw()
    messagebox.showinfo("Инструкция", "3D визуализация запущена!\n\n• Вращайте график мышкой\n• Закройте окно для выхода")
    root.destroy()

class ProteinViz:
    def __init__(self):
        self.r0 = 4.2
        self.theta0 = 15.0
        
    def calculate_energy(self, r, theta):
        """Упрощенный расчет энергии"""
        return 10 * (1 - np.tanh((r - self.r0)/2)) * np.cos(np.radians(theta - self.theta0))
    
    def create_plot(self):
        # Создаем данные
        r = np.linspace(2, 8, 50)
        theta = np.linspace(-30, 60, 50)
        R, Theta = np.meshgrid(r, theta)
        Energy = self.calculate_energy(R, Theta)
        
        # Настраиваем график
        fig = plt.figure(figsize=(10, 7))
        ax = fig.add_subplot(111, projection='3d')
        surf = ax.plot_surface(R, Theta, Energy, cmap='plasma')
        
        # Подписи
        ax.set_xlabel('Расстояние (Å)')
        ax.set_ylabel('Угол (°)')
        ax.set_zlabel('Энергия')
        ax.set_title('Белковая динамика: Свободная энергия')
        fig.colorbar(surf, label='Энергия (кДж/моль)')
        
        plt.tight_layout()
        plt.show()

if __name__ == "__main__":
    try:
        # Проверка библиотек
        try:
            import numpy as np
            import matplotlib.pyplot as plt
        except ImportError:
            import sys
            import subprocess
            subprocess.check_call([sys.executable, "-m", "pip", "install", "numpy", "matplotlib"])
            
        show_message()
        viz = ProteinViz()
        viz.create_plot()
        
    except Exception as e:
        root = tk.Tk()
        root.withdraw()
        messagebox.showerror("Ошибка", f"Ошибка: {str(e)}\n\n1. Убедитесь, что установлен Python 3.x\n2. При установке отметьте 'Add Python to PATH'")
        root.destroy()